{% load widget_tweaks %}

<div class="col-xl-12">
                    <div class="card">

                        <div class="card-body">
                            <!-- Nav tabs -->
                            <div class="default-tab">
                                <ul class="nav nav-tabs" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" data-toggle="tab" href="#home"><i
                                                class="la la-home mr-2"></i>عمومی</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link " data-toggle="tab" href="#home2"><i
                                                class="la la-home mr-2"></i>زمانبندی</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-toggle="tab" href="#profile"><i
                                                class="la la-user mr-2"></i> تکمیلی</a>
                                    </li>

                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane fade show active" id="home" role="tabpanel">
                                      <div class="row">
                                        <div class="col-md-12 mt-3">
                                          <div class="form-group">
                                            <label>{{form.taskTypes.label}}</label>
                                            {{form.taskTypes| add_class:"form-control border-primary" }}

                                          </div>

                                        </div>




                                      </div>
                                      <div class="row taskmetricrow" id="taskmetricrow" style=" margin-top:20px;">


                                      </div>
                                      <div class="row">
                                        <div class="col-lg-12">

                                          <label>{{form.taskDescription.label}}</label>


                                          {{form.taskDescription| add_class:"form-control border-primary" }}
                                        </div>
                                      </div>
                                      <div class="row" style="margin-top: 20px">
                                        <div class="col-lg-12">
                                          <div class="form-group">
                                            <label>{{form.taskAssignedToUser.label}}</label>
                                            {% render_field form.taskAssignedToUser class="form-control border-primary selectpicker" data-show-subtext="true" data-live-search="true"  %}

                                          </div>



                                          </div>


                                      </div>

                                    </div>
                                    <div class="tab-pane fade " id="home2" role="tabpanel">


                                      <div class="row" >
                                        <div class="col-md-12  mb-3">
                                    <label>{{form.taskStartDate.label}}</label>
                                    <div class="input-group">
                                      {{form.taskStartDate| add_class:"form-control border-primary" }} <span class="input-group-append">
                                          <span class="input-group-text"><i class="fa fa-calendar-o"></i></span></span>
                                    </div>
                                </div>
                                        <div class="col-md-12  mb-3">
                                    <label>{{form.taskStartTime.label}}</label>
                                    <div class="input-group clockpicker">
                                      {{form.taskStartTime| add_class:"form-control border-primary" }} <span class="input-group-append">
                                          <span class="input-group-text"><i class="fa fa-clock-o"></i></span></span>
                                    </div>
                                </div>



                                      </div>

                                      <div class="row" style="margin-top:20px">
                                        <div class="col-md-12  mb-3">
                                          <div class="form-group">
                                            <label>{{form.taskTimeEstimate.label}}</label>
                                            {{form.taskTimeEstimate| add_class:"form-control border-primary" }}

                                          </div>


                                          </div>


                                      </div>
                                    </div>
                                    <div class="tab-pane fade" id="profile">
                                      <div class="row">
                                        <div class="col-md-12 mb-3">

                                          <div class="form-group">
                                            <label>{{form.taskResult.label}}</label>
                                            {% render_field form.taskResult class="form-control border-primary "  %}



                                          </div>
                                          <div class="form-group">
                                            <label>{{form.taskDateCompleted.label}}</label>

                                            <div class="input-group date">
                                                                       {{form.taskDateCompleted| add_class:"form-control border-primary" }}
                                                                       <span class="input-group-addon">
                                                                           <i class="fa fa-calendar">
                                                                           </i>
                                                                       </span>
                                                                   </div>

                                          </div>
                                          <div class="form-group">
                                            <label>{{form.taskTimeCompleted.label}}</label>
                                            <div class="input-group clockpicker">
                                              {{form.taskTimeCompleted| add_class:"form-control border-primary" }} <span class="input-group-append">
                                                  <span class="input-group-text"><i class="fa fa-clock-o"></i></span></span>
                                            </div>
                                            {% if perms.cmms.delete_tasks %}
                                            <button type="button"
                                                       class="btn btn-default btn-sm set-auto-completion-time" id="set-auto-completion-time" date-url="{{form.instance.id}}">
                                                 <span class="glyphicon glyphicon-refresh"></span>
                                               </button>
                                            {% endif %}



                                          </div>
                                          <div class="form-group">
                                            <label>{{form.taskTimeSpent.label}}</label>
                                            {{form.taskTimeSpent| add_class:"form-control border-primary" }}




                                          </div>
                                          <div class="form-group">

                                            <label>{{form.taskCompletionNote.label}}</label>


                                            {{form.taskCompletionNote| add_class:"form-control border-primary" }}

                                          </div>



                                          </div>


                                      </div>








                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
<script>
  $('.clockpicker').clockpicker();
$('#id_taskStartDate').pDatepicker({
                format: 'YYYY-MM-DD',
                autoClose: true,
                initialValueType: 'gregorian'
            });

            if($('#id_taskDateCompleted').val().length>0)
            {
              console.log($("#id_taskDateCompleted").val());
              $('#id_taskDateCompleted').pDatepicker({
                              format: 'YYYY-MM-DD',
                              autoClose: true,
                              initialValueType: 'gregorian'
                          });
            }
            else{
              $('#id_taskDateCompleted').pDatepicker({
                              format: 'YYYY-MM-DD',
                              autoClose: true,
                              initialValueType: 'gregorian'
                          }).val('');
            }



                      $("#id_taskDateCompleted").change(function(){
                        $.ajax({
                          url: '/Task/'+$("#id_taskStartDate").val()+'/'+$("#id_taskDateCompleted").val()+'/'+$("#id_taskStartTime").val()+'/'+$("#id_taskTimeCompleted").val()+'/TaskWorkHour/',
                          type: 'get',
                          dataType: 'json',
                          beforeSend: function () {
                            //alert(btn.attr("data-url"));



                          },
                          success: function (data) {
                            // console.log(data);
                            $("#id_taskTimeSpent").val(data.task_hour_result);
                          }
                        });

                      });





</script>
